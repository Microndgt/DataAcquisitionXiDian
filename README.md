# DataAcquisitionXiDian

低压元器件应用验证测试系统

>没想到Github上最多star也是唯一的star项目居然是LabVIEW的，不过话说回来，这个项目投入的精力也是非常多的，前前后后不知道改了多少次，然后现在项目基本结束了，那个项目负责人把尾款仍然没有打过来，我也不想要了，和这种人合作真是心累。
现在就把所有的程序上传上去，供大家学习参考，程序可能也不是很好，因为每次修改都以为是最后一次修改，然后就写的比较乱。
上传之前我对所有VI大概做了一个分类，在LabVIEW里面是虚拟文件夹，实际是没有文件夹分开的。
其中start.vi是启动VI，另外InitConfig.vi,InitSelfcheck.vi,instru.vi这几个是可以直接打开运行的。对了忘了说一点，必须有相应的硬件才能运行，所以大家就看看程序怎么实现的好了。
里面也上传了一个说明书，大家可以对照看看。
如果有任何问题，随时发邮件：dgt_x@foxmail.com
另外：***本程序仅供学习参考，不得用于其他如商业用途。All rights reserved***

---

登录界面
1.	在桌面上打开测试系统软件程序，首先进入的是系统登陆界面，如图所示。

填写用户名和密码后点击登陆即可登录系统。如果用户名或者密码输入错误，最下面的提示栏会提示用户，如图所示。

如果用户想退出程序，点击退出即可。
自检程序
1.	点击登录成功后会进入自检界面，耐心等待自检程序运行完成。如图所示。


用户配置界面
1.	如果是第一次运行程序或者是继续上次的试验，则完成自检后会进入用户配置界面，如图所示。

否则会直接进入程序主界面。
2.	进入实验配置界面后，首先必须要设置程序数据采集后保存的Excel文件的存放目录，用户必须手动输入一个文件夹名称，点击确定按钮，程序会根据该名称创建一个路径，用来存储输出的电子表格文件。程序创建的基路径是C:\output_xls\。

3.	接下来用户根据自己的需要选择对应的实验类型，其中自动测试下面包括调用已有项目，温循，高温老练，自定义和单次共5个项目。如图所示。

λ	自动测试
4.	点击调用已有参数，会显示已经保存的参数，用户只需要选择要使用第几条参数，就可以载入相应的参数内容，然后点击确定按钮即可进入程序主界面。若要返回上一级界面，点击返回键。退出程序点击退出按钮。
5.	点击温循，用户可以设置温循的试验时间，点击确定按钮即可进入程序主界面。温循的数据采集频率和示波器切换频率均已经设定好了，分别是：5s/条和10s/条。
6.	点击高温老练，用户可以设置高温老练的试验时间，点击确定按钮即可进入程序主界面。高温老练的数据采集频率和示波器切换通道频率均已经设定好了，分别是：5s/条和10s/条。
7.	点击自定义，用户既可以设置试验时间，也可以设置示波器切换通道频率，其中设置最小值是10。点击确定按钮进入程序主界面。
8.	点击单次，程序将自动进入试验主界面，自动开始单次试验。
9.	上述五个自动测试类型，必须在点击确定之前设置好试验数据输出文件夹，否则点击确定将不会进入试验主界面，并且会给予提示。
λ	手动测试
10.	点击手动测试，进入手动测试设置参数界面，如图所示。

点击确定后进入试验主界面后，采集程序和示波器通道切换程序均需要手动操作。
11.	点击退出按钮，则退出程序。
试验主界面
1.	进入试验主界面会自动打开两个窗口，分别是数据采集界面和示波器通道控制界面，两个窗口分别如图所示。

λ	数据采集界面

2.	设置串口，是设置和下位机通信的串口地址，一般不需要改动。如果出现无法与下位机通信的情况，可以在这里尝试修改串口地址。
3.	现在进行的试验类型，表示现在正在进行的试验类型，共有以下几种：温循，高温老练，单次，自定义，已有参数这五种类型。
4.	图形显示，该处将会实时显示从下位机传输过来的数据，共有8条曲线。在图形显示区右侧有图例区，可以配置曲线的参数。在图例区的曲线上点击左键，即可设置曲线。
5.	数据显示，该处会显示8个通道所采集并且保存的数据，点击CH1-CH8选项卡，即可查看CH1-CH8通道的数据，数据刷新周期和数据采集周期基本一致。点击查询按钮，即可实时刷新数据显示。在该区域点击右键，可以选择复制数据或者导出数据。
6.	开始采集，点击开始采集，上位机将开始采集并显示数据。
7.	停止采集，点击停止采集，上位机将停止采集并停止显示数据。
8.	退出，点击退出按钮，将退出整个试验程序。退出时，首先会弹出对话框，点击确定后程序自动检测该次试验是否完成，如果本次试验尚未达到预定的试验时间，则会弹出对话框，用户可以选择是否继续本次试验，选择是则下次进入程序直接继续本次试验，选择否，下次进入程序则会开始新的试验。点击取消则程序不会关闭。
9.	菜单栏，其中系统菜单项内的开始采集，停止采集，退出与上述功能是一致的。设置参数菜单项内的设置上下限将会设置采集数据超限报警的限制值，点击该菜单，进入设置的登录界面，登录成功后，即可对各个通道的上下限进行设置。
λ	示波器通道控制界面


10.	地址，该处是上位机与示波器的通信地址，如果存在无法正常连接示波器的情况，在这里选择其他可以使用的地址尝试连接示波器。
11.	复位，如果示波器连接上，但是不能正常工作，点击复位按钮即可使示波器恢复初始状态。
12.	仪表信息，点击仪表信息按钮后，如果上位机与示波器连接正常，则可以查询到仪表的信息。如果不正常，则显示区为空。
13.	上述10-12项，必须退出自动采集才可以设置。
14.	查询各通道的参数值区域，该区域将实时显示每一个示波器通道切换后从示波器传输过来的各个参数。
15.	第14项区域下方是通道手动切换区域，点击电压通道或者电流通道的相应通道，下位机将切换至相应通道。
16.	自动采集，点击该按钮，程序将开始自动采集。
17.	停止自动采集，点击该按钮，程序将停止自动采集。只有在系统处于停止自动采集状态，10，11，12以及15项才可用。
18.	示波器界面右侧是截图显示区域和数据显示区域，在系统处于自动采集状态时，截图区域和数据将自动更新。
19.	截图选项卡，在程序处于自动采集状态的时候，根据切换通道的频率，将周期的显示每次切换通道后的截图。在程序未处于自动采集的时候，点击保存截图按钮，将会手动的将该通道的图形显示出来。
20.	各个通道的数据显示选项卡和数据采集界面的数据显示区域类似。

21.	点击选项卡上方的查询按钮，将会实时的将各个示波器通道的数据查询并显示在数据显示区。
数据存储位置
1.	整个采集的数据作为数据库存储在C:\database\下，包括以下文件夹：温循，高温老练，单次，自定义和已有参数，分别存储的是不同试验类型的采集数据。
2.	每次试验完成之后程序将在配置界面用户创建的目录输出本次试验的Excel数据。
3.	示波器截图将存放在C:\database\pic文件夹内。每次切换通道后示波器传输回的截图的路径将存放在Excel数据表的最后一列。

更新日期：2016年6月3日星期五
如有任何问题，请联系：dgt_x@foxmail.com

---

---

A project created for XiDianUniversity

and VIs contained in project have been protected by password

and email me: dgt_x@foxmail.com  to get it!

All rights reserved!

---

###写一写关于LabVIEW使用数据库的那些事

首先呢，LabVIEW开发系统自带有与**数据库进行连接**的库，注意是连接，因为直接通过LabVIEW是无法创建数据库的，LabVIEW只自带了和数据库进行连接的库。但是通过ActiveX是可以创建数据库的。

###1. 具体介绍一下如何通过ActiveX(自动化引用句柄)来创建数据库：

自动化引用句柄－与ActiveX函数配合使用。当打开一个指向ActiveX服务器对象的引用，且需要将引用作为参数传递给另一个VI时，可使用该类引用句柄控件。如需指定引用句柄的类型，可右键单击控件，从快捷菜单中选择选择ActiveX类»浏览，打开从类型库中选择对象对话框，浏览可用的ActiveX服务器应用程序。

首先在前面板上点击右键，在引用句柄下选择自动化引用句柄，放置在前面板上，在建立的图标上右击，点击选择ActiveX类，自定义，进入选择对话框。如图所示：

![选择ActiveX类](http://7xq6lu.com1.z0.glb.clouddn.com/activex2.png "选择ActiveX类")

选择如图所示的ADOX._Catalog后，转入程序框图，编写程序如图所示：

![程序框图](http://7xq6lu.com1.z0.glb.clouddn.com/activex1.png "程序框图")

该程序最关键的一步是设置合理的ConnectString，这个ConnectString是代表数据库的连接信息。这个连接信息是使用LabVIEW自带库函数操作数据库最关键的一个信息了，因此集中放在下一节解释。

###2. 如何使用LabVIEW自带的Database库函数操作数据库

连接并使用数据库的一个基本流程就是，open connection->Execute Query->Fetch Recordset Data->Free Object->Close connection.

如图所示：

![流程](http://7xq6lu.com1.z0.glb.clouddn.com/1.png "流程")

其中open connection函数涉及到连接数据库一个关键的内容就是设置合理的连接字符串，连接字符串包括Provider和Data Source，Provider一般是与连接的数据库属性有关的，在这里我使用的是Microsoft的Acess因此连接字符串的Provider是：Provider=Microsoft.JET.OLEDB.4.0;然后DataSource是你将要连接的数据库地址。将这两个字符串连接起来，传入open connection函数中的connection information端子上。

Execute Query函数接受一个SQL语句的字符串，用于进行数据库操作。SQL语句语法等内容请移步：[SQL语句](http://www.w3school.com.cn/sql/ "SQL语句")

其中Fetch Recordset是用于读取数据的，这里面有另外一个核心技术，就是将数据库查询出来的变体数据转换至字符串数据，下面将会介绍。

最后是Free Object和Close connection函数，也就是释放对象并且关闭连接。在这里我曾经遇到一个问题，利用for循环进行了多次的Execute Query之后调用Free Object和Close Connection会输出504错误，Open recordset object，由于vi也能正常实现功能，所以这个也不能完全算是错误，但是如果错误随着错误流输出的话会影响以后程序的运行，因此在Close connection函数后面加一个清楚错误函数，将该504错误清除。
